@using Microsoft.AspNetCore.Identity
@using static EventifyMVC.Enums.Enums;
@model AdminIndexVM

@{
    var searchTerm = Context.Request.Query["term"];
    var currentPage = Context.Request.Query["pageNumber"];
    var sort = Context.Request.Query["orderBy"];


    if (String.IsNullOrEmpty(currentPage))
    {
        currentPage = "1";
    }
}

<partial name="_Notification" />

<div class="container p-3 rounded-xl shadow">
    <div class="row mb-3">
        <div class="col-12 pb-3">
            <h2 class="text-2xl font-semibold">Admins</h2>
        </div>
        <hr />

        <div class="col-md-6 mt-3">
            <form asp-area="SuperAdmin" asp-controller="Admin" asp-action="Index" method="get" class="row g-3">
                <div class="col-md-4">
                    <input name="term" id="searchInput" class="form-control" placeholder="Search for admins" value="@searchTerm" />
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary"><i class="bi bi-search"></i> Search</button>
                </div>
            </form>
        </div>
        <div class="col-md-6 text-end mt-3">
            <a asp-area="Identity" asp-page="/Account/Register" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Create New Admin
            </a>
        </div>
    </div>

@if(Model.TotalResults > 0 && int.Parse(currentPage) <= Model.TotalPages)
{
    <table class="table table-striped mt-4" style="width:100%">
    <thead>
        <tr>
            <th></th>
            <th>
                <a asp-action="Index" asp-route-orderBy="@Model.EmailSortOrder" asp-route-term="@searchTerm" class="flex items-center gap-x-3 text-black">
                    Email <partial name="_SortingCaret" model="@Model.EmailSortOrder" />
                </a>
            </th>
            <th>
                        <a asp-action="Index" asp-route-orderBy="@Model.FirstNameSortOrder" asp-route-term="@searchTerm" class="flex items-center gap-x-3 text-black">
                    First Name <partial name="_SortingCaret" model="@Model.FirstNameSortOrder" />
                </a>
            </th>
            <th>
                        <a asp-action="Index" asp-route-orderBy="@Model.LastNameSortOrder" asp-route-term="@searchTerm" class="flex items-center gap-x-3 text-black">
                    Last Name <partial name="_SortingCaret" model="@Model.LastNameSortOrder" />
                </a>
            </th>
            <th>Phone Number</th>
            <th>Address</th>
            <th>
                        <a asp-action="Index" asp-route-orderBy="@Model.DateSortOrder" asp-route-term="@searchTerm" class="flex items-center gap-x-3 text-black">
                    Date Joined <partial name="_SortingCaret" model="@Model.DateSortOrder" />
                </a>
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var identityUser in Model.Users)
        {
         var user = identityUser as ApplicationUser;

            <tr>
                <td class="align-middle"><img src="@user?.ImageUrl" class="w-10 h-10 rounded-full" /></td>
                <td class="align-middle">@user.UserName</td>
                <td class="align-middle">@user.FirstName</td>
                <td class="align-middle">@user.LastName</td>
                <td class="align-middle">@user.PhoneNumber</td>
                <td class="align-middle">@user.Address</td>
                <td class="align-middle">@user.Created_at.ToString("dd-MM-yyyy")</td>
                <td class="align-middle dropdown-center "><i role="button" data-bs-toggle="dropdown" aria-expanded="false" class="bi bi-three-dots" style="cursor: pointer;"></i>
                    <ul class="dropdown-menu">
                        <li style="cursor: pointer;"><a asp-area="SuperAdmin" asp-controller="Admin" asp-action="Edit" asp-route-userId="@user.Id" class="dropdown-item nav-link text-dark font-medium text-gray-500 text-center "><i class="bi bi-pencil text-lg text-green-600 me-2"></i>Edit Permissions</a></li>
                        <li style="cursor: pointer;" role="button" data-bs-toggle="modal" data-bs-target="#modal@(user.Id)"><a class="dropdown-item nav-link text-dark font-medium text-gray-500 text-center"><i class="bi bi-ban text-lg text-red-600 me-2"></i>Remove Admin</a></li>
                    </ul>
                </td>
                        <div class="modal fade" id="modal@(user.Id)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="exampleModalLabel">Delete Category</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body text-center text-lg">
                                        <p>
                                            Are you sure you want to remove <br /><strong class="text-xl">@user.FirstName @user.LastName</strong> as admin?
                                        </p>
                                <p><strong>@user.FirstName</strong> won't be able to use this account anymore.</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                            <form method="post" asp-action="Delete" asp-route-userId="@user.Id" >
                                            <button type="submit" class="btn bg-red-600 text-white font-medium">Remove</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
            </tr>
        }
    </tbody>
</table>

        <div class="row">
            <div class="col-md-6">
                Showing <strong>@((int.Parse(currentPage) * (int)PageSize.Default) - ((int)PageSize.Default - 1))</strong> to <strong>@(int.Parse(currentPage) * (int)PageSize.Default <= Model.TotalResults ? int.Parse(currentPage) * (int)PageSize.Default : Model.TotalResults)</strong> of <strong>@Model.TotalResults</strong> results
            </div>
            @if (Model.TotalPages > 1)
            {
                <div class="col-md-6 d-flex justify-content-end">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination">
                            @if (int.Parse(currentPage) != 1)
                            {
                                <li class="page-item me-2"><a class="page-link" asp-area="SuperAdmin" asp-controller="Admin" asp-action="Index" asp-route-term="@searchTerm" asp-route-orderBy="@sort" asp-route-pageNumber="@(int.Parse(currentPage) - 1)">Previous</a></li>
                            }

                            @for (int i = 1; i <= Model.TotalPages; i++)
                            {
                                <li class="page-item @(i == int.Parse(currentPage) ? "active" : "")"><a class="page-link" asp-area="SuperAdmin" asp-controller="Admin" asp-action="Index" asp-route-term="@searchTerm" asp-route-orderBy="@sort" asp-route-pageNumber="@i">@i</a></li>
                            }

                            @if (int.Parse(currentPage) != Model.TotalPages)
                            {
                                <li class="page-item ms-2"><a class="page-link" asp-area="SuperAdmin" asp-controller="Admin" asp-action="Index" asp-route-term="@searchTerm" asp-route-orderBy="@sort" asp-route-pageNumber="@(int.Parse(currentPage) + 1)">Next</a></li>
                            }
                        </ul>
                    </nav>
                </div>
            }
        </div>
    }
    else
    {
        <img src="@Url.Content("~/images/noResultsFound.png")" class="block mx-auto w-1/6 -mt-10" />
        <h1 class="text-center text-xl font-semibold -mt-5">No results found. Please try a different search!</h1>
    }
</div>











